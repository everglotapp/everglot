<script lang="ts">
    import { goto } from "@sapper/app"
    import { LogOutIcon } from "svelte-feather-icons"
    import ButtonSmall from "../util/ButtonSmall.svelte"

    export let segment: string | undefined
</script>

<div class="nav-container">
    <nav class="flex container mx-auto px-2">
        <div class="flex flex-grow-0 self-center">
            <a
                aria-current={segment === undefined ? "page" : undefined}
                class="logo font-bold uppercase tracking-wide"
                href="/">Everglot</a
            >
        </div>
        <div
            class="flex flex-1 mx-auto justify-between"
            style="max-width: 820px;"
        >
            <div class="flex justify-center">
                <div class="flex">
                    <a
                        aria-current={segment === "global" ? "page" : undefined}
                        href="/global"
                        class="nav-item-with-icon"
                        ><span>Global</span>
                        <svg
                            width="32"
                            height="32"
                            viewBox="0 0 53 53"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <g>
                                <path
                                    d="M26.5 0.442627C14.0736 0.442627 4 10.8597 4 23.7097C4 36.5597 14.0736 46.9767 26.5 46.9767C38.9264 46.9767 49 36.5597 49 23.7097C49 10.8597 38.9264 0.442627 26.5 0.442627ZM18.9107 42.291C14.1483 40.2055 10.3808 36.2513 8.4348 31.2963C6.48885 26.3412 6.52352 20.7902 8.53122 15.8616C8.62686 15.6287 8.72687 15.3978 8.83122 15.1689L13.75 19.7471V25.8775L20.9781 33.7921H24.625V38.547L20.2139 42.8044C19.775 42.6496 19.3406 42.4785 18.9107 42.291ZM40.2886 37.9683C38.4801 39.844 36.3309 41.3314 33.9645 42.345C31.5982 43.3586 29.0613 43.8784 26.5 43.8744C25.5677 43.8745 24.6365 43.8063 23.7136 43.6702L27.625 39.8951V30.6898H22.2719L16.75 24.6441V18.3654L10.3469 12.4065C12.4654 9.17966 15.4386 6.6527 18.9103 5.12832C21.881 3.8288 25.1173 3.31243 28.3287 3.62556C31.54 3.9387 34.6259 5.07154 37.3094 6.9224L33.0378 12.6017L34.4899 16.3559L33.507 17.3724L26.1365 15.8481L22 19.0563V27.5875H38.5L43.2198 34.0951C42.3991 35.505 41.4147 36.8057 40.2886 37.9683ZM46 23.7097C46.0044 26.1904 45.5634 28.6505 44.6994 30.9648L40 24.4852H25V20.6074L26.8635 19.1621L34.493 20.7401L38.0101 17.1032L36.4622 13.1017L39.6685 8.83835C39.8786 9.03767 40.0851 9.2419 40.2882 9.45104C42.1021 11.3211 43.5406 13.5436 44.5208 15.9906C45.5011 18.4377 46.0038 21.061 46 23.7097Z"
                                    fill="#45CDCD"
                                />
                            </g>
                        </svg>
                    </a>
                    <a
                        aria-current={segment === "languages"
                            ? "page"
                            : undefined}
                        href="/languages"
                        class="nav-item-with-icon"
                        ><span>Languages</span>
                        <svg
                            width="32"
                            height="32"
                            viewBox="0 0 52 51"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <g>
                                <path
                                    d="M43.6672 4.16666H21.445V11.1111H24.2228V6.94443H43.6672C44.5005 6.94443 45.0561 7.49999 45.0561 8.33332V23.6111C45.0561 24.4444 44.5005 25 43.6672 25H25.6117V34.7222H18.2505L13.1117 38.75V34.7222H8.94499C8.11165 34.7222 7.5561 34.1667 7.5561 33.3333V18.0555C7.5561 17.2222 8.11165 16.6667 8.94499 16.6667H27.0005V13.8889H8.94499C6.58388 13.8889 4.77832 15.6944 4.77832 18.0555V33.3333C4.77832 35.6944 6.58388 37.5 8.94499 37.5H10.3339V44.5833L19.0839 37.5H28.3894V27.7778H43.6672C46.0283 27.7778 47.8339 25.9722 47.8339 23.6111V8.33332C47.8339 5.97221 46.0283 4.16666 43.6672 4.16666Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M10.6113 31.8056H13.9447L14.778 29.5833H19.0835L19.9169 31.8056H23.2502L18.528 19.4445H15.1947L10.6113 31.8056ZM16.8613 22.9167L18.2502 27.2222H15.4724L16.8613 22.9167Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M29.7783 23.6111C31.3061 23.6111 33.3894 23.1945 35.3339 22.2222C37.2783 23.1945 39.5005 23.6111 40.8894 23.6111V20.8333C40.8894 20.8333 39.5005 20.8333 37.9728 20.2778C39.6394 18.6111 40.8894 16.1111 40.8894 12.5V11.1111H36.7228V8.33334H33.945V11.1111H29.7783V13.8889H37.9728C37.695 16.3889 36.5839 17.9167 35.3339 18.8889C34.5005 18.1945 33.6672 17.2222 33.1117 15.9722H30.195C30.7505 17.7778 31.5839 19.1667 32.695 20.2778C31.3061 20.8333 30.0561 20.8333 29.7783 20.8333V23.6111Z"
                                    fill="#45CDCD"
                                />
                            </g>
                        </svg>
                    </a>
                </div>
            </div>
            <div class="flex justify-center items-center">
                <!-- TODO: Search -->
                <div class="my-auto">
                    <ButtonSmall
                        variant="TEXT"
                        tag="button"
                        href="/profile"
                        on:click={() => {
                            fetch("/logout", {
                                method: "post",
                                headers: {
                                    Accept: "application/json",
                                    "Content-Type": "application/json",
                                },
                                redirect: "follow", // if user isn't signed in anymore
                            }).then(() => {
                                goto("/login")
                            })
                        }}
                        ><span class="hidden md:inline md:mr-1">Logout</span
                        ><LogOutIcon size="24" /></ButtonSmall
                    >
                </div>
            </div>
            <div class="flex justify-center">
                <div class="flex">
                    <a
                        aria-current={segment === "groups" ? "page" : undefined}
                        href="/groups"
                        class="nav-item-with-icon"
                        ><span>My Groups</span>
                        <svg
                            width="32"
                            height="32"
                            viewBox="0 0 58 53"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <g>
                                <path
                                    d="M28.8612 22.4398C32.6112 22.4398 35.5279 19.6898 35.5279 16.3148C35.5279 12.9398 32.4723 10.3148 28.7223 10.3148C24.9723 10.3148 22.0557 13.0648 22.0557 16.3148C22.0557 19.6898 25.1112 22.4398 28.8612 22.4398ZM28.7223 12.8148C28.8612 12.8148 28.8612 12.8148 28.7223 12.8148C30.9446 12.8148 32.7501 14.4398 32.7501 16.4398C32.7501 18.4398 30.9446 19.9398 28.7223 19.9398C26.5001 19.9398 24.8334 18.3148 24.8334 16.4398C24.8334 14.4398 26.639 12.8148 28.7223 12.8148Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M49.4163 21.6898C46.7775 19.5648 43.3052 18.4398 39.6941 18.5648H38.583C38.3052 19.5648 37.8886 20.4398 37.333 21.1898C38.1663 21.0648 38.8608 21.0648 39.6941 21.0648C42.333 20.9398 44.9719 21.6898 47.0552 23.0648V32.0648H49.833V22.0648L49.4163 21.6898Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M36.5001 10.5648C37.1946 9.06482 39.139 8.31482 40.9446 8.93982C42.6112 9.56482 43.4446 11.3148 42.7501 12.9398C42.1946 14.0648 40.9446 14.8148 39.6946 14.8148C39.4168 14.8148 39.0001 14.8148 38.7223 14.6898C38.8612 15.3148 38.8612 15.9398 38.8612 16.4398V17.1898C39.139 17.1898 39.4168 17.3148 39.6946 17.3148C43.1668 17.3148 45.9446 14.8148 45.9446 11.8148C45.9446 8.68982 43.1668 6.18982 39.8334 6.18982C37.6112 6.18982 35.6668 7.18982 34.5557 8.93982C35.2501 9.31482 35.9446 9.81482 36.5001 10.5648Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M20.667 21.3148C20.1114 20.5648 19.6948 19.6898 19.417 18.6898H18.3059C14.6948 18.5648 11.2225 19.6898 8.58366 21.6898L8.16699 22.0648V32.0648H10.9448V23.0648C13.167 21.6898 15.667 20.9398 18.3059 21.0648C19.1392 21.0648 19.9725 21.1898 20.667 21.3148Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M18.3051 17.1898C18.5829 17.1898 18.8607 17.1898 19.1385 17.0648V16.3148C19.1385 15.6898 19.1385 15.0648 19.2773 14.5648C18.9996 14.6898 18.5829 14.6898 18.3051 14.6898C16.4996 14.6898 14.9718 13.3148 14.9718 11.6898C14.9718 10.0648 16.4996 8.68984 18.3051 8.68984C19.694 8.68984 20.944 9.43984 21.4996 10.5648C22.0551 9.93984 22.8885 9.31484 23.5829 8.81484C21.7773 6.18984 18.0273 5.31484 15.1107 6.93984C12.194 8.56484 11.2218 11.9398 13.0273 14.5648C14.1385 16.1898 16.0829 17.1898 18.3051 17.1898Z"
                                    fill="#45CDCD"
                                />
                                <path
                                    d="M40.2498 29.1898L39.972 28.8148C37.1942 26.0648 33.3053 24.4398 29.1387 24.5648C24.972 24.4398 20.9442 26.0648 18.1664 28.8148L17.8887 29.1898V38.6898C17.8887 39.8148 18.8609 40.8148 20.2498 40.8148H38.0276C39.2776 40.8148 40.3887 39.8148 40.3887 38.6898V29.1898H40.2498ZM37.472 38.3148H20.6664V30.0648C22.8887 28.0648 25.9442 27.0648 29.1387 27.0648C32.1942 26.9398 35.2498 28.0648 37.472 30.0648V38.3148Z"
                                    fill="#45CDCD"
                                />
                                <rect
                                    x="5.5"
                                    y="2.31482"
                                    width="47"
                                    height="42"
                                    stroke="#45CDCD"
                                    stroke-width="3"
                                />
                            </g>
                        </svg>
                    </a>
                    <a
                        aria-current={segment === "profile"
                            ? "page"
                            : undefined}
                        href="/profile"
                        class="nav-item-with-icon justify-center"
                    >
                        <div class="profile-icon" /></a
                    >
                </div>
            </div>
        </div>
    </nav>
</div>

<style>
    .nav-container {
        @apply shadow-md;
        @apply bg-white;

        position: relative;
        z-index: 10;
        max-height: 84px;
    }

    a[aria-current] {
        position: relative;
    }

    a[aria-current]::after {
        position: absolute;
        content: "";
        height: 2px;
        display: block;
        bottom: 0;
        left: 0;
        right: 0;

        @apply bg-accent;
    }

    a[aria-current].logo::after {
        background-color: transparent;
    }

    a {
        display: flex;
        padding: 0.75rem 1rem;
        text-decoration: none;

        @apply text-gray-bitdark;
        @apply text-center;
    }

    a.logo {
        @apply text-black;
    }

    a:hover {
        @apply bg-gray-verylight;
    }

    .nav-item-with-icon {
        @apply flex;
        @apply flex-col;
        @apply items-center;
        @apply gap-y-1;
        @apply justify-center;
    }

    .profile-icon {
        border-radius: 50%;
        width: 42px;
        height: 42px;

        @apply bg-gray-light;
    }
</style>
